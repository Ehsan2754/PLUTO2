{% extends 'base.html' %}
{% block title%}
Dashboard
{% endblock %}

{% block body%}
<div class="form">
    <header id="header">
        <h1>Single Photon QC Laboratory</h1>
        <h2>Dashboard</h2>
    </header>
    <main>
        <section>
            <div id="column1">
                <form action="/plot" method="POST">
                    <div style="padding: 2%;">
                        <label>Gaussian Waist Beam values</label>
                        <input type="number" name="w" placeholder="Gaussian Waist Beam" required="required" value="{{ preload.gussianWaist }}" />
                        <label>#Lagurrel-Gussian parameters</label>
                        <input type="number" name="nLG" placeholder="#Lagurrel-Gussian parameter" required="required"
                            value="{{ preload.nValues }}" min="1" id="nLG" />
                        <label>Lagurrel-Gussian Values</label>
                    </div>
                    <div id="parm">
                        {% if preload.nValues < 1 %} <h5> Invalid quantity of parameters.</h5>
                            {% else %}
                            {% for item in range(preload.nValues): %}
                            <input type="number" 
                                name="LG{{ item+1 }}" 
                                placeholder="L-G parameter{{ item+1 }}" 
                                required="required" 
                                value="{{ preload.values[item].parameter }}" />
                                <br>
                            <input type="number"
                                name="C{{ item+1 }}"
                                placeholder="L-G Coefficient{{ item+1 }}"
                                required="required"
                                oninput="this.value = Math.abs(this.value)"
                                value="{{ preload.values[item].coefficient }}" />
                                <br>
                            {% endfor %}
                            {% endif %}
                    </div>
                    <label>Scanning Postion</label>
                    <input type="number" name="w" placeholder="Scanning Postion" required="required" value="{{ preload.scanPos }}" />
                    <label>Scanning Range</label>
                    <input type="number" name="w" placeholder="Scanning Range" required="required" value="{{ preload.scanRange }}" />
                    <button type="submit" class="btn btn-primary btn-block btn-large">Plot</button>

                </form>
                <script>

                    document.getElementById("nLG").onchange = function () {
                        document.getElementById("parm").innerHTML = ''
                        for (i = 0; i < document.getElementById("nLG").value; i++) {
                            document.getElementById("parm").innerHTML += `
                        <input type="number" name="LG${i + 1}" placeholder="L-G parameter${i + 1}" required="required" />
                        <br>
                        <input type="number" name="C${i + 1}" placeholder="L-G Coefficient${i + 1}" required="required" />
                        <br>
                        `
                        }
                    };
                </script>
            </div>
            <div id="column2">
                <img src="data:image/bmp;base64," width="100%" height="100%" />
            </div>
        </section>
        <section>
            <div class="column1">
                <form action='/slm' method="POST">
                    {% if devices|length < 1 %} <h5> No devices found. </h5>
                    {% else %}
                    <label for="slm">Choose a SLM device:</label>
                    <select style="width: 48%;" id="slm" name="slm">
                        {% for item in devices %}
                        <option value="{{item}}">{{item}}</option>
                        {% endfor %}
                    </select>
                    {% endif %}
                    <button action="\slm" type="submit" class="btn btn-primary btn-block btn-large">Upload to
                        SLM</button>
                    <a method="POST" href='\refreshSLM' class="btn btn-primary btn-block btn-large">Refresh</a>
                </form>
            </div>
            <div class="column2"> {% if history|length < 1 %} <h5> No Logged information. </h5>
                    {% else %}
                    <table>
                        <tr>
                            <th>ID</th>
                            <th>Destionation</th>
                            <th>Gaussian Waist</th>
                            <th>#L-G parameters</th>
                            <th>L-G parameters</th>
                            <th>Scanning Postion</th>
                            <th>Scanning Scroll</th>
                            <th>Created Date</th>
                            <th>Actions</th>
                        </tr>
                        {% for item in history: %}
                        <tr>
                            <td>{{ item.id }}</td>
                            <td>{{ item.dest }}</td>
                            <td>{{ item.gussianWaist }}</td>
                            <td>{{ item.nValues }}</td>
                            <td>{{ item.values }}</td>
                            <td>{{ item.scanPos }}</td>
                            <td>{{ item.scanRange }}</td>
                            <td>{{ item.date }}</td>
                            <td>
                                <!-- <button class="btn btn-primary btn-block btn-large">Load</button> <br> -->
                                <a href="/update/{{ history.id }}">Load</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </table>
                    {% endif %}</div>
        </section>
    </main>

    Ehsan Shaghaei<br>
    <a href="https://github.com/Ehsan2754/contactlist">Github Repository</a><br>
    <a href="mailto:Ehsan2754@yahoo.com">Ehsan2754@yahoo.com</a>
</div>
{% endblock %}